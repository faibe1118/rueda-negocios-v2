<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Agenda - Rueda de Negocios</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <nav class="navbar">
        <div class="container navbar-content">
            <a href="admin-dashboard.html" class="logo">EventConnect Admin</a>
            <div class="nav-links">
                <button onclick="logout()" class="btn btn-secondary"
                    style="padding: 5px 10px; font-size: 0.9rem;">Cerrar Sesi√≥n</button>
            </div>
        </div>
    </nav>

    <div class="container dashboard-grid">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="profile.html">üë§ Mi Perfil</a>
                <a href="matches.html">ü§ù Mis Matches</a>
                <a href="agenda.html" class="active">üìÖ Mi Agenda</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main>
            <div class="card">
                <h2>Agenda de Reuniones</h2>
                <p>Gestiona tus citas programadas.</p>

                <div style="overflow-x: auto;">
                    <table id="agenda-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Hora</th>
                                <th>Empresa</th>
                                <th>Lugar</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/services/meetingService.js"></script>
    <script>
        function logout() {
            localStorage.clear();
            window.location.href = "login.html";
        }

        async function cargarAgenda() {
            const tbody = document.querySelector("#agenda-table tbody");
            const meetings = await meetingService.getSchedule();

            if (meetings.length === 0) {
                tbody.innerHTML = "<tr><td colspan='5' class='text-center'>No tienes reuniones programadas.</td></tr>";
                return;
            }

            tbody.innerHTML = "";
            meetings.forEach(m => {
                const start = new Date(m.startTime);
                const end = new Date(m.endTime);

                const empresas = `${m.matchId.supplierId.nombreEmpresa} y ${m.matchId.buyerId.nombreEmpresa}`;

                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${start.toLocaleDateString()}</td>
                    <td>${start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} - ${end.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</td>
                    <td>${empresas}</td>
                    <td>${m.location}</td>
                    <td><span style="background: rgba(34, 197, 94, 0.2); color: var(--success-color); padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">${m.status.toUpperCase()}</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        cargarAgenda();
    </script>
</body>

</html>