<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Registro - Rueda de Negocios</title>

    <script src="../js/config/api.js"></script>
    <script src="../js/services/authService.js" defer></script>
</head>

<body>
    <h1>Registro de Empresa</h1>

    <form id="registerForm" enctype="multipart/form-data">
        <fieldset>
            <legend>Credenciales</legend>
            <label>Email:</label>
            <input type="email" name="email" required><br>

            <label>Contraseña:</label>
            <input type="password" name="password" minlength="6" required><br>

            <label>Rol:</label>
            <select name="role" id="role" required>
                <option value="">Seleccione</option>
                <option value="ofertante">Ofertante</option>
                <option value="demandante">Demandante</option>
                <option value="adminEvento">AdminEvento</option>
                <option value="adminSistema">AdminSistema</option>
            </select><br>
        </fieldset>

        <fieldset>
            <legend>Datos empresa</legend>
            <label>Nombre Empresa:</label>
            <input type="text" name="nombreEmpresa" required><br>

            <label>Logo Empresa (archivo):</label>
            <input type="file" name="logoEmpresaFile" accept="image/*"><br>
            <small>Si no hay backend de uploads, puedes pegar URL en 'logoEmpresaUrl' abajo.</small>
            <input type="text" name="logoEmpresaUrl" placeholder="(opcional) URL del logo"><br>

            <label>Sector:</label>
            <select name="sector" id="sector" required>
                <option value="">Seleccione</option>
                <option value="Agroalimentos">Agroalimentos</option>
                <option value="Turismo">Turismo</option>
                <option value="TIC">TIC</option>
                <option value="Manufactura">Manufactura liviana</option>
                <option value="Servicios">Servicios empresariales</option>
                <option value="Logistica">Logística</option>
                <option value="Otro">Otro</option>
            </select>
            <input type="text" name="sectorOtro" id="sectorOtro" placeholder="Indicar otro sector"
                style="display:none;"><br>

            <label>¿La empresa está formalizada?</label>
            <select name="formalizada" id="formalizada" required>
                <option value="">Seleccione</option>
                <option value="true">Sí</option>
                <option value="false">No</option>
            </select><br>

            <!-- Si NO formalizada -->
            <div id="noFormalizadoFields" style="display:none; border:1px solid #ddd; padding:8px; margin:8px 0;">
                <h4>Documentos (No formalizada)</h4>
                <label>RUT provisional:</label>
                <input type="text" name="rutProvisional" id="rutProvisional"><br>

                <label>Comprobante Matrícula (PDF):</label>
                <input type="file" name="comprobanteMatriculaFile" accept="application/pdf"><br>
                <input type="text" name="comprobanteMatriculaUrl" placeholder="(opcional) URL del PDF"><br>

                <label>Cédula Solicitante (PDF):</label>
                <input type="file" name="cedulaSolicitanteFile" accept="application/pdf"><br>
                <input type="text" name="cedulaSolicitanteUrl" placeholder="(opcional) URL del PDF"><br>
            </div>

            <!-- Si SI formalizada -->
            <div id="formalizadoFields" style="display:none; border:1px solid #ddd; padding:8px; margin:8px 0;">
                <h4>Documentos (Formalizada)</h4>
                <label>RUT (PDF):</label>
                <input type="file" name="rutFile" accept="application/pdf"><br>
                <input type="text" name="rutUrl" placeholder="(opcional) URL del PDF"><br>

                <label>Certificado de Existencia (PDF):</label>
                <input type="file" name="certificadoExistenciaFile" accept="application/pdf"><br>
                <input type="text" name="certificadoExistenciaUrl" placeholder="(opcional) URL del PDF"><br>

                <label>Cédula Representante (PDF):</label>
                <input type="file" name="cedulaRepresentanteFile" accept="application/pdf"><br>
                <input type="text" name="cedulaRepresentanteUrl" placeholder="(opcional) URL del PDF"><br>
            </div>

            <label>Catalogo (PDF) — si eres ofertante:</label>
            <input type="file" name="catalogoFile" accept="application/pdf"><br>
            <input type="text" name="catalogoUrl" placeholder="(opcional) URL del PDF"><br>

            <label>Necesidades (PDF) — si eres demandante:</label>
            <input type="file" name="necesidadesFile" accept="application/pdf"><br>
            <input type="text" name="necesidadesUrl" placeholder="(opcional) URL del PDF"><br>
        </fieldset>

        <fieldset>
            <legend>Contacto</legend>
            <label>Correo contacto:</label>
            <input type="email" name="datosContacto.correo"><br>
            <label>Teléfono:</label>
            <input type="text" name="datosContacto.telefono"><br>
            <label>Dirección:</label>
            <input type="text" name="datosContacto.direccion"><br>
            <label>Redes (separadas por coma):</label>
            <input type="text" name="datosContacto.redes" placeholder="https://... , https://..."><br>
        </fieldset>

        <fieldset>
            <legend>Representante</legend>
            <label>Nombre representante:</label>
            <input type="text" name="representante.nombre"><br>

            <label>Documento representante (número):</label>
            <input type="text" name="representante.documento"><br>

            <label>Cargo:</label>
            <input type="text" name="representante.cargo"><br>
        </fieldset>

        <label>
            <input type="checkbox" name="aceptaTerminos" required>
            Acepto los términos y condiciones
        </label><br><br>

        <button type="submit">Registrar</button>
    </form>

    <p id="mensaje"></p>

    <script>
        // Dinámicas de mostrar/ocultar
        const formalizadaSelect = document.getElementById('formalizada');
        const noFormalizadoFields = document.getElementById('noFormalizadoFields');
        const formalizadoFields = document.getElementById('formalizadoFields');

        const sectorSelect = document.getElementById('sector');
        const sectorOtro = document.getElementById('sectorOtro');

        const roleSelect = document.getElementById('role');

        formalizadaSelect.addEventListener('change', () => {
            const formalizada = formalizadaSelect.value === 'true';
            formalizadoFields.style.display = formalizada ? 'block' : 'none';
            noFormalizadoFields.style.display = formalizada ? 'none' : 'block';
        });

        sectorSelect.addEventListener('change', () => {
            sectorOtro.style.display = sectorSelect.value === 'Otro' ? 'block' : 'none';
        });

        // Ocultar campos de catálogo/necesidades según rol
        roleSelect.addEventListener('change', () => {
            const role = roleSelect.value;
            // ofertante -> mostrar catalogo
            // demandante -> mostrar necesidades
            // adminEvento/adminSistema -> ninguno
            document.querySelector('input[name="catalogoFile"]').closest('label')?.parentElement; // noop
            // visual hide/show:
            document.querySelector('input[name="catalogoFile"]').parentElement.style.display = role === 'ofertante' ? 'block' : 'none';
            document.querySelector('input[name="catalogoUrl"]').parentElement.style.display = role === 'ofertante' ? 'block' : 'none';
            document.querySelector('input[name="necesidadesFile"]').parentElement.style.display = role === 'demandante' ? 'block' : 'none';
            document.querySelector('input[name="necesidadesUrl"]').parentElement.style.display = role === 'demandante' ? 'block' : 'none';
        });

        // Inicial: esconder catálogo y necesidades
        document.querySelector('input[name="catalogoFile"]').parentElement.style.display = 'none';
        document.querySelector('input[name="catalogoUrl"]').parentElement.style.display = 'none';
        document.querySelector('input[name="necesidadesFile"]').parentElement.style.display = 'none';
        document.querySelector('input[name="necesidadesUrl"]').parentElement.style.display = 'none';
    </script>
</body>

</html>